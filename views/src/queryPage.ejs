<head>
  <!-- js -->
  <script src="https://cdn.datatables.net/buttons/3.0.2/js/dataTables.buttons.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/rowgroup/1.5.0/js/dataTables.rowGroup.js"></script>
  <script src="/js/datatable.js"></script>
  <script src="/js/inputFieldRestriction.js" defer></script>

  <!-- Slim select -->
  <script src="/js/slim-select.js" defer></script>

  <style>
    .updateButton {
      transition: all 200ms linear;
    }
    .rotate {
      transform: rotate(180deg);
      transition: all 200ms linear;
    }
  </style>
</head>

<div class="row m-0 px-2">
  <div class="col col-md p-0 rounded-2" style="box-shadow: 0 0 10px 1px">
    <%- include('../partials/dateSelection.ejs') %>

    <div class="row m-0 ">
      <div class="mb-3">
        <label for="dryPrice" class="form-label">Mủ quy khô</label>
        <input type="text" class="form-control" id="dryPrice" oninput="handleQuantityInput(this)"  />
      </div>
      <div class="mb-3">
        <label for="mixedPrice" class="form-label">Mủ tạp</label>
        <input type="text" class="form-control" id="mixedPrice" oninput="handleQuantityInput(this)" />
      </div>
      <button class="btn btn-primary" id="inputPrice">Nhập</button>
    </div>

    <hr class="m-0" />

    <table class="table table-striped table-bordered" id="query_table">
      <thead>
        <tr>
          <th rowspan="2">STT</th>
          <th rowspan="2">Khu Vực</th>
          <th rowspan="2">Vườn</th>
          <th colspan="3">Mủ quy khô</th>
          <th colspan="3">Mủ tạp</th>
          <th rowspan="2">Ghi chú</th>
          <th rowspan="2">Tổng tiền</th>
          <th rowspan="2">Chỉnh sửa</th>
        </tr>
        <tr>
          <th>SL</th>
          <th>Đơn giá</th>
          <th>TT</th>
          <th>SL</th>
          <th>Đơn giá</th>
          <th>TT</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
  let queryColumns = [
    { data: 'no', orderable: false },
    { data: 'area', visible: false },
    { data: 'plantation' },
    { data: 'dryQuantity' },
    { data: 'dryPrice', orderable: false },
    { data: 'dryTotal', orderable: false },
    { data: 'mixedQuantity' },
    { data: 'mixedPrice', orderable: false },
    { data: 'mixedTotal', orderable: false },
    { data: 'notes', orderable: false },
    { data: 'totalMoney' },
    { data: 'id', orderable: false },
  ];
  initializeDataTable(
    '#query_table',
    '/truy-van/getQuery',
    '#staticBackdrop',
    '#deleteModalToggle',
    queryColumns,
    'area',
    '#filterButton',
    '#startDate',
    '#endDate',
    '#clearFilterButton',
    false,
    true,
    '#inputPrice', 
    '#dryPrice', 
    '#mixedPrice',
  );

  function updateDateDisplay() {
    let startDate = document.getElementById('startDate').value;
    let endDate = document.getElementById('endDate').value;
    let dateDisplay = document.querySelector('.dateSelectionSelector span');

    if (startDate || endDate) {
      startDate = startDate.split('-').reverse().join('-');
      endDate = endDate.split('-').reverse().join('-');
      dateDisplay.textContent = `Ngày: ${startDate} - ${endDate}`;
    } else {
      dateDisplay.textContent = 'Hôm nay';
    }
  }
</script>
