<head>
  <!-- js -->
  <script src="https://cdn.datatables.net/buttons/3.0.2/js/dataTables.buttons.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/rowgroup/1.5.0/js/dataTables.rowGroup.js"></script>
  <script src="/js/datatable.js"></script>
  <!-- Slim select -->
  <script src="/js/slim-select.js" defer></script>

  <style>
    .updateButton {
      transition: all 200ms linear;
    }
    .rotate {
      transform: rotate(180deg);
      transition: all 200ms linear;
    }
  </style>
</head>

<div class="row m-0 px-2">
  <div class="col col-md p-0 rounded-2" style="box-shadow: 0 0 10px 1px">
    <div class="row dateSelection">
      <div
        class="dateSelectionSelector rounded-2 mx-3 my-2 pt-2 px-2"
        style="box-shadow: 0 0 4px; width: fit-content; cursor: pointer"
        onclick="
              let container = document.querySelector('.dateSelectionContainer');
              container.style.opacity = '1';
              container.style.maxWidth ='1000px';
              container.style.maxHeight ='1000px';
              container.style.transition = 'all 200ms linear';
              this.style.opacity = '0';
              this.style.display = 'none'
              "
      >
        <h5>Lọc kết quả</h5>
      </div>

      <div
        class="col col-md-6 dateSelectionContainer rounded-2 mx-3 my-2 p-2"
        style="
          box-shadow: 0 0 4px;
          opacity: 0;
          max-width: 0;
          max-height: 0;
          transition: all 200ms linear;
        "
      >
        <div class="d-flex justify-content-between">
          <h5>Lọc kết quả</h5>
          <i
            class="ri-close-line fs-5"
            style="cursor: pointer"
            onclick="
                  let container = document.querySelector('.dateSelectionContainer');
                  let selector = document.querySelector('.dateSelectionSelector');
                  container.style.maxWidth = '0';
                  container.style.maxHeight = '0';
                  container.style.opacity = '0';
                  setTimeout(() => {
                      selector.style.display = 'inline';
                      selector.style.opacity = '1';
                  }, 200);
                  "
          ></i>
        </div>

        <div class="row">
          <div class="col">
            <label for="startDate" class="form-label">Bắt đầu:</label>
            <input type="date" id="startDate" class="form-control" onchange="updateDateDisplay()" />
          </div>
          <div class="col">
            <label for="endDate" class="form-label">Kết thúc:</label>
            <input type="date" id="endDate" class="form-control" onchange="updateDateDisplay()"/>
          </div>
        </div>

        <div class="col my-2 d-flex align-items-end">
          <button
            id="filterButton"
            class="btn btn-primary"
            onclick="document.getElementById('clearFilterButton').style.display = 'inline'"
          >
            <i class="ri-menu-search-fill"></i>
          </button>
          <button
            id="clearFilterButton"
            class="btn btn-secondary mx-2"
            style="display: none"
            onclick="this.style.display ='none'"
          >
            <i class="ri-calendar-close-line"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="row dateDisplay">
      <div class="col col-md-6">
        <h6>Ngày: Hôm nay</h6>
      </div>
    </div>
    <hr />

    <table class="table table-striped table-bordered" id="query_table">
      <thead>
        <tr>
          <th rowspan="2">STT</th>
          <th rowspan="2">Khu Vực</th>
          <th rowspan="2">Vườn</th>
          <th colspan="3">Mủ quy khô</th>
          <th colspan="3">Mủ tạp</th>
          <th rowspan="2">Ghi chú</th>
          <th rowspan="2">Tổng tiền</th>
          <th rowspan="2">Chỉnh sửa</th>
          
        </tr>
        <tr>
          <th>SL</th>
          <th>Đơn giá</th>
          <th>TT</th>
          <th>SL</th>
          <th>Đơn giá</th>
          <th>TT</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
  let queryColumns = [
    { data: 'no' },
    { data: 'area', visible: false },
    { data: 'plantation' },
    { data: 'dryQuantity' },
    { data: 'dryPrice' },
    { data: 'dryTotal' },
    { data: 'mixedQuantity' },
    { data: 'mixedPrice' },
    { data: 'mixedTotal' },
    { data: 'notes' },
    { data: 'totalMoney' },
    { data: 'id' },
  ];
  initializeDataTable(
    '#query_table',
    '/truy-van/getQuery',
    '#staticBackdrop',
    '#deleteModalToggle',
    queryColumns,
    'area',
    '#filterButton',
    '#startDate',
    '#endDate',
    '#clearFilterButton',
    false,
    true,
  );


  function updateDateDisplay() {
  let startDate = document.getElementById('startDate').value;
  let endDate = document.getElementById('endDate').value;
  let dateDisplay = document.querySelector('.dateDisplay h6');
  
  if (startDate || endDate) {
    dateDisplay.textContent = `Ngày: ${startDate} - ${endDate}`;
  } else {
    dateDisplay.textContent = 'Hôm nay';
  }
}
</script>
