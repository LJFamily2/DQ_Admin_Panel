<!-- Button to open the modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#suggestionModal" onclick="suggestMoneyDistributionForAll()">
  Gợi ý sắp xếp tiền
</button>

<div class="modal fade" id="suggestionModal" tabindex="-1" aria-labelledby="suggestionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="suggestionModalLabel">Gợi ý</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="preferredDenomination" class="form-label">Chọn mệnh giá ưu tiên</label>
          <div id="preferredDenomination">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="denomination" id="denomination500000" value="500000">
              <label class="form-check-label" for="denomination500000">500,000 VNĐ</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="denomination" id="denomination200000" value="200000">
              <label class="form-check-label" for="denomination200000">200,000 VNĐ</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="denomination" id="denomination100000" value="100000">
              <label class="form-check-label" for="denomination100000">100,000 VNĐ</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="denomination" id="denomination50000" value="50000">
              <label class="form-check-label" for="denomination50000">50,000 VNĐ</label>
            </div>
            <!-- Add more denominations as needed -->
          </div>
        </div>
        <div id="suggestionResult" class="mt-3"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
      </div>
    </div>
  </div>
</div>

<script>
function getOptimalMoneyDistribution(totalPrice, preferredDenomination) {
  const denominations = [500000, 200000, 100000, 50000, 20000, 10000, 5000, 2000, 1000];
  const distribution = {};
  let remainingAmount = totalPrice;

  if (preferredDenomination) {
    const index = denominations.indexOf(preferredDenomination);
    if (index > -1) {
      denominations.splice(index, 1);
      denominations.unshift(preferredDenomination);
    }
  }

  for (const denomination of denominations) {
    let count = Math.floor(remainingAmount / denomination); // Removed Math.min and the 100 limit
    if (count > 0) {
      distribution[denomination] = count;
      remainingAmount -= count * denomination;
    }
  }

  // Simplified remaining amount distribution (still needed for potential rounding errors)
  for (const denomination of denominations.reverse()) {
    if (remainingAmount <= 0) break;
    let count = Math.floor(remainingAmount / denomination); // Removed Math.min and the 100 limit
    if (count > 0) {
      distribution[denomination] = (distribution[denomination] || 0) + count;
      remainingAmount -= count * denomination;
    }
  }

  return distribution;
}

function suggestMoneyDistributionForAll() {
  const totals = ['.muNuocTotal', '.muTapTotal', '.muKeTotal', '.muDongTotal'].map(selector =>
    parseInt(document.querySelector(selector)?.textContent.replace(/\./g, '')) || 0
  );
  let totalSum = totals.reduce((sum, val) => sum + val, 0);

  totalSum = Math.round(totalSum / 1000) * 1000;

  const preferredDenomination = parseInt(document.querySelector('input[name="denomination"]:checked')?.value) || null;

  const resultDiv = document.getElementById('suggestionResult');

  if (totalSum > 0) {
    const distribution = getOptimalMoneyDistribution(totalSum, preferredDenomination);
    let resultHtml = `<h6>Tổng số tiền (${totalSum.toLocaleString('vi-VN')} VNĐ):</h6><ul>`;
    for (const [denomination, count] of Object.entries(distribution)) {
      resultHtml += `<li>${count} tờ ${parseInt(denomination).toLocaleString('vi-VN')} VNĐ</li>`;
    }
    resultHtml += '</ul>';
    resultDiv.innerHTML = resultHtml;
  } else {
    resultDiv.innerHTML = '<p class="text-danger">Không có tổng số tiền hợp lệ.</p>';
  }
}

document.querySelectorAll('input[name="denomination"]').forEach(radio => {
  radio.addEventListener('change', suggestMoneyDistributionForAll);
});
</script>